

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Warewulf Overlays &mdash; Warewulf User Guide main documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=4ae1632d" />

  
    <link rel="shortcut icon" href="../_static/favicon.png"/>
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=a8da1a53"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Node Provisioning" href="provisioning.html" />
    <link rel="prev" title="Node Profiles" href="profiles.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Warewulf User Guide
              <img src="../_static/logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="background.html">Background</a></li>
<li class="toctree-l1"><a class="reference internal" href="stateless.html">Stateless Provisioning</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup.html">Control Server Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Warewulf Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Warewulf Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="upgrade.html">Upgrading Warewulf</a></li>
<li class="toctree-l1"><a class="reference internal" href="wwctl.html">Controlling Warewulf (wwctl)</a></li>
<li class="toctree-l1"><a class="reference internal" href="initialization.html">Warewulf Initialization</a></li>
<li class="toctree-l1"><a class="reference internal" href="images.html">Image Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="kernel.html">Kernel Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="boot-management.html">Boot Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="nodeconfig.html">Node Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="profiles.html">Node Profiles</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Warewulf Overlays</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#structure">Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="#system-and-runtime-overlays">System and runtime overlays</a></li>
<li class="toctree-l2"><a class="reference internal" href="#distribution-and-site-overlays">Distribution and site overlays</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#provided-distribution-overlays">Provided distribution overlays</a></li>
<li class="toctree-l3"><a class="reference internal" href="#wwinit">wwinit</a></li>
<li class="toctree-l3"><a class="reference internal" href="#wwclient">wwclient</a></li>
<li class="toctree-l3"><a class="reference internal" href="#network-interfaces">Network interfaces</a></li>
<li class="toctree-l3"><a class="reference internal" href="#basics">Basics</a></li>
<li class="toctree-l3"><a class="reference internal" href="#fstab">fstab</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ssh">ssh</a></li>
<li class="toctree-l3"><a class="reference internal" href="#syncuser">syncuser</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ignition">ignition</a></li>
<li class="toctree-l3"><a class="reference internal" href="#debug">debug</a></li>
<li class="toctree-l3"><a class="reference internal" href="#host">host</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#combining-and-overriding-overlays">Combining and overriding overlays</a></li>
<li class="toctree-l2"><a class="reference internal" href="#templates">Templates</a></li>
<li class="toctree-l2"><a class="reference internal" href="#template-functions">Template functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#include">Include</a></li>
<li class="toctree-l3"><a class="reference internal" href="#includefrom">IncludeFrom</a></li>
<li class="toctree-l3"><a class="reference internal" href="#includeblock">IncludeBlock</a></li>
<li class="toctree-l3"><a class="reference internal" href="#importlink">ImportLink</a></li>
<li class="toctree-l3"><a class="reference internal" href="#basename">basename</a></li>
<li class="toctree-l3"><a class="reference internal" href="#file">file</a></li>
<li class="toctree-l3"><a class="reference internal" href="#softlink">softlink</a></li>
<li class="toctree-l3"><a class="reference internal" href="#readlink">readlink</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ignitionjson">IgnitionJson</a></li>
<li class="toctree-l3"><a class="reference internal" href="#abort">abort</a></li>
<li class="toctree-l3"><a class="reference internal" href="#nobackup">nobackup</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#managing-overlays">Managing overlays</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#build">Build</a></li>
<li class="toctree-l3"><a class="reference internal" href="#chmod">Chmod</a></li>
<li class="toctree-l3"><a class="reference internal" href="#chown">Chown</a></li>
<li class="toctree-l3"><a class="reference internal" href="#create">Create</a></li>
<li class="toctree-l3"><a class="reference internal" href="#delete">Delete</a></li>
<li class="toctree-l3"><a class="reference internal" href="#edit">Edit</a></li>
<li class="toctree-l3"><a class="reference internal" href="#import">Import</a></li>
<li class="toctree-l3"><a class="reference internal" href="#list">List</a></li>
<li class="toctree-l3"><a class="reference internal" href="#show">Show</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="provisioning.html">Node Provisioning</a></li>
<li class="toctree-l1"><a class="reference internal" href="ipmi.html">IPMI</a></li>
<li class="toctree-l1"><a class="reference internal" href="disks.html">Disk Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="security.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="templating.html">Templating</a></li>
<li class="toctree-l1"><a class="reference internal" href="dnsmasq.html">dnsmasq</a></li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="known-issues.html">Known issues</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Quickstart</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../quickstart/el.html">Enterprise Linux (Rocky Linux, CentOS, and RHEL)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart/suse15.html">openSUSE Leap and SLES 15</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart/debian12.html">Debian 12</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contributing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../contributing/contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/debugging.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/documentation.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/development-environment-devcontainer.html">Development Environment (Dev Container/VSC)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/development-environment-vagrant.html">Development Environment (Vagrant)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/development-environment-kvm.html">Development Environment (KVM)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/development-environment-vbox.html">Development Environment (VirtualBox)</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Command Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reference/wwctl.html">wwctl</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/wwctl_clean.html">wwctl clean</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/wwctl_completion.html">wwctl completion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/wwctl_completion_bash.html">wwctl completion bash</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/wwctl_completion_fish.html">wwctl completion fish</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/wwctl_completion_powershell.html">wwctl completion powershell</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/wwctl_completion_zsh.html">wwctl completion zsh</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/wwctl_configure.html">wwctl configure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/wwctl_configure_dhcp.html">wwctl configure dhcp</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/wwctl_configure_hostfile.html">wwctl configure hostfile</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/wwctl_configure_nfs.html">wwctl configure nfs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/wwctl_configure_ssh.html">wwctl configure ssh</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/wwctl_configure_tftp.html">wwctl configure tftp</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/wwctl_genconfig.html">wwctl genconfig</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/wwctl_genconfig_completions.html">wwctl genconfig completions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/wwctl_genconfig_man.html">wwctl genconfig man</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/wwctl_genconfig_reference.html">wwctl genconfig reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/wwctl_genconfig_warewulfconf.html">wwctl genconfig warewulfconf</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/wwctl_genconfig_warewulfconf_print.html">wwctl genconfig warewulfconf print</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/wwctl_image.html">wwctl image</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/wwctl_image_build.html">wwctl image build</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/wwctl_image_copy.html">wwctl image copy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/wwctl_image_delete.html">wwctl image delete</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/wwctl_image_exec.html">wwctl image exec</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/wwctl_image_import.html">wwctl image import</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/wwctl_image_kernels.html">wwctl image kernels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/wwctl_image_list.html">wwctl image list</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/wwctl_image_rename.html">wwctl image rename</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/wwctl_image_shell.html">wwctl image shell</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/wwctl_image_show.html">wwctl image show</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/wwctl_image_syncuser.html">wwctl image syncuser</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/wwctl_node.html">wwctl node</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/wwctl_node_add.html">wwctl node add</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/wwctl_node_console.html">wwctl node console</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/wwctl_node_delete.html">wwctl node delete</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/wwctl_node_edit.html">wwctl node edit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/wwctl_node_export.html">wwctl node export</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/wwctl_node_import.html">wwctl node import</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/wwctl_node_list.html">wwctl node list</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/wwctl_node_sensors.html">wwctl node sensors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/wwctl_node_set.html">wwctl node set</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/wwctl_node_status.html">wwctl node status</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/wwctl_overlay.html">wwctl overlay</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/wwctl_overlay_build.html">wwctl overlay build</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/wwctl_overlay_chmod.html">wwctl overlay chmod</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/wwctl_overlay_chown.html">wwctl overlay chown</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/wwctl_overlay_create.html">wwctl overlay create</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/wwctl_overlay_delete.html">wwctl overlay delete</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/wwctl_overlay_edit.html">wwctl overlay edit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/wwctl_overlay_import.html">wwctl overlay import</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/wwctl_overlay_list.html">wwctl overlay list</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/wwctl_overlay_mkdir.html">wwctl overlay mkdir</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/wwctl_overlay_show.html">wwctl overlay show</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/wwctl_power.html">wwctl power</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/wwctl_power_cycle.html">wwctl power cycle</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/wwctl_power_off.html">wwctl power off</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/wwctl_power_on.html">wwctl power on</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/wwctl_power_reset.html">wwctl power reset</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/wwctl_power_soft.html">wwctl power soft</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/wwctl_power_status.html">wwctl power status</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/wwctl_profile.html">wwctl profile</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/wwctl_profile_add.html">wwctl profile add</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/wwctl_profile_delete.html">wwctl profile delete</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/wwctl_profile_edit.html">wwctl profile edit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/wwctl_profile_list.html">wwctl profile list</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/wwctl_profile_set.html">wwctl profile set</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/wwctl_server.html">wwctl server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/wwctl_ssh.html">wwctl ssh</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/wwctl_upgrade.html">wwctl upgrade</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/wwctl_upgrade_config.html">wwctl upgrade config</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/wwctl_upgrade_nodes.html">wwctl upgrade nodes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/wwctl_version.html">wwctl version</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Configuration Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reference/man5/nodes.conf.html">nodes.conf(5)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/man5/warewulf.conf.html">warewulf.conf(5)</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Warewulf User Guide</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Warewulf Overlays</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/warewulf/warewulf/blob/main/userdocs/contents/overlays.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="warewulf-overlays">
<h1>Warewulf Overlays<a class="headerlink" href="#warewulf-overlays" title="Link to this heading"></a></h1>
<p>Warewulf is designed to scalably provision and manage thousands of cluster nodes by utilizing
identical stateless boot images. But if these boot images are completely identical, then how do we
configure things like hostnames? IP addresses? Or any other node-specific configurations?</p>
<p>Some of configuration can be managed by services like DHCP. You can also use traditional
configuration management on a provisioned Warewulf cluster node. But these are heavy-weight
solutions to a simple problem.</p>
<p>Warewulf addresses cluster node configuration with its <strong>overlay</strong> system. Overlays are collections
of files and templates that are rendered and built per-node and then applied over the image
image during the provisioning process.</p>
<section id="structure">
<h2>Structure<a class="headerlink" href="#structure" title="Link to this heading"></a></h2>
<p>An overlay is a directory that is applied to the root of a cluster node’s runtime file system. The
overlay source directory should contain a single <code class="docutils literal notranslate"><span class="pre">rootfs</span></code> directory which represents the actual
root directory for the overlay.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/usr/share/warewulf/overlays/issue
└── rootfs
    └── etc
        └── issue.ww
</pre></div>
</div>
</section>
<section id="system-and-runtime-overlays">
<h2>System and runtime overlays<a class="headerlink" href="#system-and-runtime-overlays" title="Link to this heading"></a></h2>
<p>A node or profile can configure an overlay in two different ways:</p>
<ul class="simple">
<li><p>An overlay can be configured to apply only during boot as part of the <code class="docutils literal notranslate"><span class="pre">wwinit</span></code> process. These
overlays are called <strong>system overlays</strong>.</p></li>
<li><p>An overlay can be configured to also apply periodically while the system is running. These overlays
are called <strong>runtime overlays</strong>.</p></li>
</ul>
<p>Overlays are built (e.g., with <code class="docutils literal notranslate"><span class="pre">wwctl</span> <span class="pre">overly</span> <span class="pre">build</span></code>) into compressed overlay images for
distribution to cluster nodes. These images typically match these two use cases: system and
runtime. As such, each cluster node typically has two overlay images.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/var/lib/warewulf/provision/overlays/tn1
├── __RUNTIME__.img
├── __RUNTIME__.img.gz
├── __SYSTEM__.img
└── __SYSTEM__.img.gz
</pre></div>
</div>
</section>
<section id="distribution-and-site-overlays">
<h2>Distribution and site overlays<a class="headerlink" href="#distribution-and-site-overlays" title="Link to this heading"></a></h2>
<p>Warewulf also distinguishes between <strong>distribution</strong> overlays, which are included with Warewulf, and
<strong>site</strong> overlays, which are created or added locally. A site overlay always takes precedence over a
distribution overlay with the same name.  Any modification of a distribution overlay with <code class="docutils literal notranslate"><span class="pre">wwctl</span></code>
actually makes changes to an automatically-generated <strong>site</strong> overlay cloned from the distribution
overlay.</p>
<p>Site overlays are often stored at <code class="docutils literal notranslate"><span class="pre">/var/lib/warewulf/overlays/</span></code>. Distribution overlays are often
stored at <code class="docutils literal notranslate"><span class="pre">/usr/share/warewulf/overlays/</span></code>. But these paths are dependent on compilation,
distribution, packaging, and configuration settings.</p>
<section id="provided-distribution-overlays">
<h3>Provided distribution overlays<a class="headerlink" href="#provided-distribution-overlays" title="Link to this heading"></a></h3>
<p>These overlays are provided as part of Warewulf.</p>
</section>
<section id="wwinit">
<h3>wwinit<a class="headerlink" href="#wwinit" title="Link to this heading"></a></h3>
<p>The <strong>wwinit</strong> overlay performs initial configuration of the Warewulf node.
Its <cite>wwinit</cite> script runs before <code class="docutils literal notranslate"><span class="pre">systemd</span></code> or other init is called and
contains all configurations which are needed to boot.</p>
<p>In particular:</p>
<ul class="simple">
<li><p>Configure the loopback interface</p></li>
<li><p>Configure the BMC based on the node’s configuration</p></li>
<li><p>Update PAM configuration to allow missing shadow entries</p></li>
<li><p>Relabel the file system for SELinux</p></li>
</ul>
<p>Other overlays may place additional scripts in <code class="docutils literal notranslate"><span class="pre">/warewulf/init.d/</span></code> to affect
node configuration in this pre-boot environment.</p>
</section>
<section id="wwclient">
<h3>wwclient<a class="headerlink" href="#wwclient" title="Link to this heading"></a></h3>
<p>All configured overlays are provisioned initially along with the node image
itself; but <strong>wwclient</strong> periodically fetches and applies the runtime overlay
to allow configuration of some settings without a reboot.</p>
</section>
<section id="network-interfaces">
<h3>Network interfaces<a class="headerlink" href="#network-interfaces" title="Link to this heading"></a></h3>
<p>Warewulf ships with support for many different network interface configuration
systems. All of these are applied by default; but the list may be trimmed to
the desired system.</p>
<ul class="simple">
<li><p>ifcfg</p></li>
<li><p>NetworkManager</p></li>
<li><p>debian.interfaces</p></li>
<li><p>wicked</p></li>
</ul>
<p>Warewulf also configures both systemd and udev with the intended names of
configured network interfaces, typically based on a known MAC address.</p>
<ul class="simple">
<li><p>systemd.netname</p></li>
<li><p>udev.netname</p></li>
</ul>
</section>
<section id="basics">
<h3>Basics<a class="headerlink" href="#basics" title="Link to this heading"></a></h3>
<p>The <strong>hostname</strong> overlay sets the hostname based on the configured Warewulf
node name.</p>
<p>The <strong>hosts</strong> overlay configures <code class="docutils literal notranslate"><span class="pre">/etc/hosts</span></code> to include all Warewulf nodes.</p>
<p>The <strong>issue</strong> overlay configures a standard Warewulf status message for display
during login.</p>
<p>The <strong>resolv</strong> overlay configures <code class="docutils literal notranslate"><span class="pre">/etc/resolv.conf</span></code> based on the value of
“DNS” nettags. (In most situations this should be unnecessary, as the network
interface configuration should handle this dynamically.)</p>
</section>
<section id="fstab">
<h3>fstab<a class="headerlink" href="#fstab" title="Link to this heading"></a></h3>
<p>The <strong>fstab</strong> overlay configures <code class="docutils literal notranslate"><span class="pre">/etc/fstab</span></code> based on the data provided in the “fstab”
resource. It also creates entries for file systems defined by Ignition.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">nodeprofiles</span><span class="p">:</span>
<span class="w">  </span><span class="nt">default</span><span class="p">:</span>
<span class="w">    </span><span class="nt">resources</span><span class="p">:</span>
<span class="w">      </span><span class="nt">fstab</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">spec</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">warewulf:/home</span>
<span class="w">          </span><span class="nt">file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/home</span>
<span class="w">          </span><span class="nt">vfstype</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nfs</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">spec</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">warewulf:/opt</span>
<span class="w">          </span><span class="nt">file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/opt</span>
<span class="w">          </span><span class="nt">vfstype</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nfs</span>
</pre></div>
</div>
</section>
<section id="ssh">
<h3>ssh<a class="headerlink" href="#ssh" title="Link to this heading"></a></h3>
<p>Two SSH overlays configure host keys (one set for all node in the cluster) and
<code class="docutils literal notranslate"><span class="pre">authorized_keys</span></code> for the root account.</p>
<ul class="simple">
<li><p>ssh.authorized_keys</p></li>
<li><p>ssh.host_keys</p></li>
</ul>
</section>
<section id="syncuser">
<h3>syncuser<a class="headerlink" href="#syncuser" title="Link to this heading"></a></h3>
<p>The <strong>syncuser</strong> overlay updates <code class="docutils literal notranslate"><span class="pre">/etc/passwd</span></code> and <code class="docutils literal notranslate"><span class="pre">/etc/group</span></code> to include
all users on both the Warewulf server and from the image. To function
properly, <code class="docutils literal notranslate"><span class="pre">wwctl</span> <span class="pre">image</span> <span class="pre">syncuser</span></code> must have also been run on the image
image to synchronize its user and group IDs with those of the server.</p>
</section>
<section id="ignition">
<h3>ignition<a class="headerlink" href="#ignition" title="Link to this heading"></a></h3>
<p>The <strong>ignition</strong> overlay defines partitions and file systems on local disks.</p>
</section>
<section id="debug">
<h3>debug<a class="headerlink" href="#debug" title="Link to this heading"></a></h3>
<p>The <strong>debug</strong> overlay is not intended to be used in configuration, but is
provided as an example. In particular, the provided <cite>tstruct.md.ww</cite> demonstrates
the use of most available template metadata.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>wwctl<span class="w"> </span>overlay<span class="w"> </span>show<span class="w"> </span>--render<span class="w"> </span>&lt;nodename&gt;<span class="w"> </span>debug<span class="w"> </span>tstruct.md.ww
</pre></div>
</div>
</section>
<section id="host">
<h3>host<a class="headerlink" href="#host" title="Link to this heading"></a></h3>
<p>Configuration files used for the configuration of the Warewulf host /
server are stored in the <strong>host</strong> overlay. Unlike other overlays, it
<em>must</em> have the name <code class="docutils literal notranslate"><span class="pre">host</span></code>. Existing files on the host are copied
to backup files with a <code class="docutils literal notranslate"><span class="pre">wwbackup</span></code> suffix at the first
run. (Subsequent use of the host overlay won’t overwrite existing
<code class="docutils literal notranslate"><span class="pre">wwbackup</span></code> files.)</p>
<p>The following services get configuration files via the host overlay:</p>
<ul class="simple">
<li><p>ssh keys are created with the scrips <code class="docutils literal notranslate"><span class="pre">ssh_setup.sh</span></code> and
<code class="docutils literal notranslate"><span class="pre">ssh_setup.csh</span></code></p></li>
<li><p>hosts entries are created by manipulating <code class="docutils literal notranslate"><span class="pre">/etc/hosts</span></code> with the
template <code class="docutils literal notranslate"><span class="pre">hosts.ww</span></code></p></li>
<li><p>nfs kernel server receives its exports from the template
<code class="docutils literal notranslate"><span class="pre">exports.ww</span></code></p></li>
<li><p>the dhcpd service is configured with <code class="docutils literal notranslate"><span class="pre">dhcpd.conf.ww</span></code></p></li>
</ul>
</section>
</section>
<section id="combining-and-overriding-overlays">
<h2>Combining and overriding overlays<a class="headerlink" href="#combining-and-overriding-overlays" title="Link to this heading"></a></h2>
<p>Multiple overlays can be applied to a single node, and overlays from multiple profiles are appended
together. The configuration fields for the system and runtime overlays are lists and can contain
several overlays. As an example for this, we will overwrite the <code class="docutils literal notranslate"><span class="pre">/etc/issue</span></code> file from the “issue”
overlay. For this we will create a new overlay called “welcome” and import the file <code class="docutils literal notranslate"><span class="pre">/etc/issue</span></code>
from the host to it. This overlay is then combined with the existing overlays.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>wwctl<span class="w"> </span>overlay<span class="w"> </span>create<span class="w"> </span>welcome
<span class="gp"># </span>wwctl<span class="w"> </span>overlay<span class="w"> </span>mkdir<span class="w"> </span>welcome<span class="w"> </span>/etc
<span class="gp"># </span>wwctl<span class="w"> </span>overlay<span class="w"> </span>import<span class="w"> </span>welcome<span class="w"> </span>/etc/issue
<span class="gp"># </span>wwctl<span class="w"> </span>profile<span class="w"> </span><span class="nb">set</span><span class="w"> </span>default<span class="w"> </span>--wwinit<span class="o">=</span>wwinit,wwclient,welcome
<span class="go">? Are you sure you want to modify 1 profile(s)? [y/N] y</span>
<span class="gp"># </span>wwctl<span class="w"> </span>profile<span class="w"> </span>list<span class="w"> </span>default<span class="w"> </span>-a<span class="w"> </span><span class="p">|</span>grep<span class="w"> </span>welcome
<span class="go">default              SystemOverlay      wwinit,wwclient,welcome</span>
</pre></div>
</div>
</section>
<section id="templates">
<h2>Templates<a class="headerlink" href="#templates" title="Link to this heading"></a></h2>
<p>Templates allow you to create dynamic content such that the files
downloaded for each node will be customized for that node. Templates
allow you to insert everything from variables, to including files from
the control node, as well as conditional content and loops.</p>
<p>Warewulf uses the <code class="docutils literal notranslate"><span class="pre">text/template</span></code> engine to facilitate implementing dynamic
content in a simple and standardized manner. This template format is documented
at <a class="reference external" href="https://pkg.go.dev/text/template">https://pkg.go.dev/text/template</a>.</p>
<p>All template files will end with the suffix of <code class="docutils literal notranslate"><span class="pre">.ww</span></code>. That tells
Warewulf that when building a file, that it should parse that file as
a template. When it does that, the resulting file is static and can
have node customizations that are obtained from the node configuration
attributes.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When the file is persisted within the built overlay, the <code class="docutils literal notranslate"><span class="pre">.ww</span></code>
will be dropped, so <code class="docutils literal notranslate"><span class="pre">/etc/hosts.ww</span></code> will end up being
<code class="docutils literal notranslate"><span class="pre">/etc/hosts</span></code>.</p>
</div>
</section>
<section id="template-functions">
<h2>Template functions<a class="headerlink" href="#template-functions" title="Link to this heading"></a></h2>
<p>Warewulf templates have access to a number of functions.</p>
<p>In addition to the custom functions below, the <a class="reference external" href="https://masterminds.github.io/sprig/">sprig functions</a> are also
available.</p>
<section id="include">
<h3>Include<a class="headerlink" href="#include" title="Link to this heading"></a></h3>
<p>Reads content from the given file into the template. If the file does not begin
with <code class="docutils literal notranslate"><span class="pre">/</span></code> it is considered relative to <code class="docutils literal notranslate"><span class="pre">Paths.Sysconfdir</span></code>.</p>
<div class="highlight-plaintext notranslate"><div class="highlight"><pre><span></span>{{ Include &quot;/root/.ssh/authorized_keys&quot; }}
</pre></div>
</div>
</section>
<section id="includefrom">
<h3>IncludeFrom<a class="headerlink" href="#includefrom" title="Link to this heading"></a></h3>
<p>Reads content from the given file from the given image into the template.</p>
<div class="highlight-plaintext notranslate"><div class="highlight"><pre><span></span>{{ IncludeFrom $.ImageName &quot;/etc/passwd&quot; }}
</pre></div>
</div>
</section>
<section id="includeblock">
<h3>IncludeBlock<a class="headerlink" href="#includeblock" title="Link to this heading"></a></h3>
<p>Reads content from the given file into the template, stopping when the provided
abort string is found.</p>
<div class="highlight-plaintext notranslate"><div class="highlight"><pre><span></span>{{ IncludeBlock &quot;/etc/hosts&quot; &quot;# Do not edit after this line&quot; }}
</pre></div>
</div>
</section>
<section id="importlink">
<h3>ImportLink<a class="headerlink" href="#importlink" title="Link to this heading"></a></h3>
<p>Causes the processed template file to becoma a symlink to the same target as the
referenced symlink.</p>
<div class="highlight-plaintext notranslate"><div class="highlight"><pre><span></span>{{ ImportLink &quot;/etc/localtime&quot; }}
</pre></div>
</div>
</section>
<section id="basename">
<h3>basename<a class="headerlink" href="#basename" title="Link to this heading"></a></h3>
<p>Returns the base name of the given path.</p>
<div class="highlight-plaintext notranslate"><div class="highlight"><pre><span></span>{{- range $type, $name := $.Tftp.IpxeBinaries }}
 if option architecture-type = {{ $type }} {
     filename &quot;/warewulf/{{ basename $name }}&quot;;
 }
{{- end }}
</pre></div>
</div>
</section>
<section id="file">
<h3>file<a class="headerlink" href="#file" title="Link to this heading"></a></h3>
<p>Write the content from the template to the specified file name. May be specified
more than once in a template to write content to multiple files.</p>
<div class="highlight-plaintext notranslate"><div class="highlight"><pre><span></span>{{- range $devname, $netdev := .NetDevs }}
{{- $filename := print &quot;ifcfg-&quot; $devname &quot;.conf&quot; }}
{{ file $filename }}
{{/* content here */}}
{{- end }}
</pre></div>
</div>
</section>
<section id="softlink">
<h3>softlink<a class="headerlink" href="#softlink" title="Link to this heading"></a></h3>
<p>Causes the processed template file to become a symlink to the referenced target.</p>
<div class="highlight-plaintext notranslate"><div class="highlight"><pre><span></span>{{ printf &quot;%s/%s&quot; &quot;/usr/share/zoneinfo&quot; .Tags.localtime | softlink }}
</pre></div>
</div>
</section>
<section id="readlink">
<h3>readlink<a class="headerlink" href="#readlink" title="Link to this heading"></a></h3>
<p>Equivalent to <code class="docutils literal notranslate"><span class="pre">filepath.EvalSymlinks</span></code>. Returns the target path of a named
symlink.</p>
<div class="highlight-plaintext notranslate"><div class="highlight"><pre><span></span>{{ readlink /etc/localtime }}
</pre></div>
</div>
</section>
<section id="ignitionjson">
<h3>IgnitionJson<a class="headerlink" href="#ignitionjson" title="Link to this heading"></a></h3>
<p>Generates JSON suitable for use by Ignition to create</p>
</section>
<section id="abort">
<h3>abort<a class="headerlink" href="#abort" title="Link to this heading"></a></h3>
<p>Immediately aborts processing the template and does not write a file.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{{</span> <span class="n">abort</span> <span class="p">}}</span>
</pre></div>
</div>
</section>
<section id="nobackup">
<h3>nobackup<a class="headerlink" href="#nobackup" title="Link to this heading"></a></h3>
<blockquote>
<div><p>Disables the creation of a backup file when replacing files with the current
template.</p>
</div></blockquote>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{{</span> <span class="n">nobackup</span> <span class="p">}}</span>
</pre></div>
</div>
</section>
</section>
<section id="managing-overlays">
<h2>Managing overlays<a class="headerlink" href="#managing-overlays" title="Link to this heading"></a></h2>
<p>Warewulf includes a command group for manipulating overlays (<code class="docutils literal notranslate"><span class="pre">wwctl</span>
<span class="pre">overlay</span></code>). With this you can add, edit, remove, change ownership,
permissions, etc.</p>
<section id="build">
<h3>Build<a class="headerlink" href="#build" title="Link to this heading"></a></h3>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">wwctl overlay build [-H,--hosts|-N,--nodes|-o,--output directory|-O,--overlay-name] nodepattern</span>
</pre></div>
</div>
<p>Without any arguments the command will interpret the templates for all
overlays for every compute node and also all the templates in the host
overlay. For every overlay of the compute nodes a gzip compressed cpio
archive is created. The range of the nodes can be restricted as the
last argument.  With the <code class="docutils literal notranslate"><span class="pre">-H</span></code> flag only the host overlay is
built. With the <code class="docutils literal notranslate"><span class="pre">-N</span></code> flag only compute node overlays are
built. Specific overlays can be selected with <code class="docutils literal notranslate"><span class="pre">-O</span></code> flag. For
debugging purposes the templates can be written to a directory given
via the <code class="docutils literal notranslate"><span class="pre">-o</span></code> flag.</p>
<p>Overlay images for multiple node are built in parallel. By default, each CPU in
the Warewulf server will build overlays independently. The number of workers
can be specified with the <code class="docutils literal notranslate"><span class="pre">--workers</span></code> option.</p>
<p>Warewulf will attempt to build/update overlays as needed
(configurable in the <code class="docutils literal notranslate"><span class="pre">warewulf.conf</span></code>); but not all cases are detected,
and manual overlay builds are often necessary.</p>
</section>
<section id="chmod">
<h3>Chmod<a class="headerlink" href="#chmod" title="Link to this heading"></a></h3>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">wwctl overlay chmod overlay-name filename mode</span>
</pre></div>
</div>
<p>This subcommand changes the permissions of a single file within an
overlay. You can use any mode format supported by the chmod command.</p>
</section>
<section id="chown">
<h3>Chown<a class="headerlink" href="#chown" title="Link to this heading"></a></h3>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">wwctl overlay chown overlay-name filename UID [GID]</span>
</pre></div>
</div>
<p>With this command you can change the ownership of a file within a
given overlay to the user specified by UID. Optionally, it will also
change group ownership to GID.</p>
</section>
<section id="create">
<h3>Create<a class="headerlink" href="#create" title="Link to this heading"></a></h3>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">wwctl overlay create overlay-name</span>
</pre></div>
</div>
<p>This command creates a new empty overlay with the given name.</p>
</section>
<section id="delete">
<h3>Delete<a class="headerlink" href="#delete" title="Link to this heading"></a></h3>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">wwctl overlay delete [-f,--force] overlay-name [File [File ...]]</span>
</pre></div>
</div>
<p>Either the given overlay is deleted (must be empty or use the
<code class="docutils literal notranslate"><span class="pre">--force</span></code> flag) or the specified file within the overlay is
deleted. With the <code class="docutils literal notranslate"><span class="pre">--parents</span></code> flag the directory of the deleted file
is also removed if no other file is in the directory.</p>
</section>
<section id="edit">
<h3>Edit<a class="headerlink" href="#edit" title="Link to this heading"></a></h3>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">wwctl overlay edit [--mode,-m MODE|--parents,-p] overlay-name file</span>
</pre></div>
</div>
<p>Use this command to edit an existing or a new file in the given
overlay. If a the new file ends with a <code class="docutils literal notranslate"><span class="pre">.ww</span></code> suffix an example
template header is added to the file. With the <code class="docutils literal notranslate"><span class="pre">--parents</span></code> flag
necessary parent directories for a new file are created.</p>
</section>
<section id="import">
<h3>Import<a class="headerlink" href="#import" title="Link to this heading"></a></h3>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">wwctl overlay import [--mode,-m|--noupdate,-n] overlay-name file-name [new-file-name]</span>
</pre></div>
</div>
<p>The given file is imported to the overlay. If no new-file-name is
given, the file will be placed in the overlay at the same path as on
the host. With the <code class="docutils literal notranslate"><span class="pre">--noupdate</span></code> flag you can block the rebuild of
the overlays.</p>
</section>
<section id="list">
<h3>List<a class="headerlink" href="#list" title="Link to this heading"></a></h3>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">wwctl overlay list [--all,-a|--long,-l] [overlay-name]</span>
</pre></div>
</div>
<p>With this command all existing overlays and files in them can be
listed. Without any option only the overlay names and their number of
files are listed. With the <code class="docutils literal notranslate"><span class="pre">--all</span></code> switch also the every file is
shown. The <code class="docutils literal notranslate"><span class="pre">--long</span></code> option will also display the permissions, UID,
and GID of each file.</p>
</section>
<section id="show">
<h3>Show<a class="headerlink" href="#show" title="Link to this heading"></a></h3>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">wwctl overlay show [--quiet,-q|--render,-r nodename] overlay-name file</span>
</pre></div>
</div>
<p>The content of the file for the given overlay is displayed with this
command. With the <code class="docutils literal notranslate"><span class="pre">--render</span></code> option a template is rendered as it
will be rendered for the given node. The node name is a mandatory
argument to the <code class="docutils literal notranslate"><span class="pre">--render</span></code> flag. Additional information for the file
can be suppressed with the <code class="docutils literal notranslate"><span class="pre">--quiet</span></code> option.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="profiles.html" class="btn btn-neutral float-left" title="Node Profiles" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="provisioning.html" class="btn btn-neutral float-right" title="Node Provisioning" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>