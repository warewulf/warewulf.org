

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Control Server Setup &mdash; Warewulf User Guide main documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=4ae1632d" />

  
    <link rel="shortcut icon" href="../_static/favicon.png"/>
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=a8da1a53"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Warewulf Installation" href="installation.html" />
    <link rel="prev" title="Stateless Provisioning" href="stateless.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Warewulf User Guide
              <img src="../_static/logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="background.html">Background</a></li>
<li class="toctree-l1"><a class="reference internal" href="stateless.html">Stateless Provisioning</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Control Server Setup</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#operating-system-installation">Operating System Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#network">Network</a></li>
<li class="toctree-l2"><a class="reference internal" href="#addressing">Addressing</a></li>
<li class="toctree-l2"><a class="reference internal" href="#multiple-networks">Multiple networks</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Warewulf Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Warewulf Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="wwctl.html">Controlling Warewulf (wwctl)</a></li>
<li class="toctree-l1"><a class="reference internal" href="initialization.html">Warewulf Initialization</a></li>
<li class="toctree-l1"><a class="reference internal" href="images.html">Image Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="kernel.html">Kernel Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="boot-management.html">Boot Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="nodeconfig.html">Node Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="profiles.html">Node Profiles</a></li>
<li class="toctree-l1"><a class="reference internal" href="overlays.html">Warewulf Overlays</a></li>
<li class="toctree-l1"><a class="reference internal" href="provisioning.html">Node Provisioning</a></li>
<li class="toctree-l1"><a class="reference internal" href="ipmi.html">IPMI</a></li>
<li class="toctree-l1"><a class="reference internal" href="disks.html">Disk Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="security.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="templating.html">Templating</a></li>
<li class="toctree-l1"><a class="reference internal" href="dnsmasq.html">dnsmasq</a></li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="known-issues.html">Known issues</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Quickstart</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../quickstart/el.html">Enterprise Linux (Rocky Linux, CentOS, and RHEL)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart/suse15.html">openSUSE Leap and SLES 15</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart/debian12.html">Debian 12</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contributing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../contributing/contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/debugging.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/documentation.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/development-environment-vagrant.html">Development Environment (Vagrant)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/development-environment-kvm.html">Development Environment (KVM)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/development-environment-vbox.html">Development Environment (VirtualBox)</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Warewulf User Guide</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Control Server Setup</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/warewulf/warewulf/blob/main/userdocs/contents/setup.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="control-server-setup">
<h1>Control Server Setup<a class="headerlink" href="#control-server-setup" title="Link to this heading"></a></h1>
<section id="operating-system-installation">
<h2>Operating System Installation<a class="headerlink" href="#operating-system-installation" title="Link to this heading"></a></h2>
<p>Warewulf has almost no predetermined or required configurations aside
from a base architecture networking layout. Install your Linux
distribution of choice as you would like, but do pay attention to the
cluster’s private network configuration.</p>
</section>
<section id="network">
<h2>Network<a class="headerlink" href="#network" title="Link to this heading"></a></h2>
<p>A clustered resource depends on a private management network. This
network can be either persistent (it is always “up” even after
provisioning) to temporary which might only be used for provisioning
and/or out of band system control and management e.g. IPMI).</p>
<p>It is important for this management network to be private to the
compute resource because Warewulf requires network services on that
network which may conflict with services on the production/public
network (e.g. DHCP). It is also important from a security perspective
as the management network for typical HPC systems have an implied
trust level associated with it and generally there is no firewalling
or network monitoring occurring on these networks.</p>
<p>Usually, the control node is “dual homed” which means it has at least
two interface cards, one connected to the private cluster network and
one dedicated to the public network (as the figure above
demonstrates).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is possible to omit the public network interface with a reverse
NAT. Warewulf can operate in this configuration but it extends
beyond the scope of this documentation.</p>
</div>
<p>Many clusters have more than one private network. This is common for
performance critical HPC clusters that implement a high speed and low
latency network like InfiniBand. In this case, this network is used
for high speed data transfers for inter-process communication between
compute nodes and file system IO.</p>
<p>Warewulf will need to be configured to use the private cluster
management network. Warewulf will use this network for booting the
nodes over PXE. There are three network protocols used to accomplish
this DHCP/BOOT, TFTP, and HTTP on port <code class="docutils literal notranslate"><span class="pre">9873</span></code>. Warewulf will use the
operating system’s provided version of DHCP (ISC-DHCP) and TFTP for
the PXE bootstrap to iPXE, and then iPXE will use Warewulf’s internal
HTTP services to transfer the larger files for provisioning.</p>
</section>
<section id="addressing">
<h2>Addressing<a class="headerlink" href="#addressing" title="Link to this heading"></a></h2>
<p>The addressing scheme of your private cluster network is 100% up to
the system integrator, but for large clusters, many organizations like
to organize the address allocations. Below is a recommended IP
addressing scheme which we will use for the rest of this document.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">10.0.0.1</span></code>: Private network address IP</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">255.255.252.0</span></code>: Private network subnet mask (<code class="docutils literal notranslate"><span class="pre">10.0.0.0/22</span></code>)</p></li>
</ul>
<p>Here is an example of how the cluster’s address can be divided for a
255 node cluster:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">10.0.0.1</span> <span class="pre">-</span> <span class="pre">10.0.0.255</span></code>: Cluster infrastructure including this
host, schedulers, file systems, routers, switches, etc.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">10.0.1.1</span> <span class="pre">-</span> <span class="pre">10.0.1.255</span></code>: DHCP range for booting nodes</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">10.0.2.1</span> <span class="pre">-</span> <span class="pre">10.0.2.255</span></code>: Static node addresses</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">10.0.3.1</span> <span class="pre">-</span> <span class="pre">10.0.3.255</span></code>: IPMI and/or out of band addresses for the
compute nodes</p></li>
</ul>
</section>
<section id="multiple-networks">
<h2>Multiple networks<a class="headerlink" href="#multiple-networks" title="Link to this heading"></a></h2>
<p>It is possible to configure several networks not just for the nodes but also for the management of <code class="docutils literal notranslate"><span class="pre">dhcpd</span></code> and <code class="docutils literal notranslate"><span class="pre">tftp</span></code>.
There are two ways to achive this:</p>
<ol class="arabic simple">
<li><p>Add the networks to the templates of <code class="docutils literal notranslate"><span class="pre">dhcpd</span></code> and/or the <code class="docutils literal notranslate"><span class="pre">dnsmasq</span></code> template directly.</p></li>
<li><p>Add the networks to a dummy node and change the templates of <code class="docutils literal notranslate"><span class="pre">dhcp</span></code> and <code class="docutils literal notranslate"><span class="pre">dnsmasq</span></code> accordingly.</p></li>
</ol>
<p>As the first solution is trivial only the second way is described in the following lines.</p>
<p>As first the first step, add the dummy node.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>wwctl<span class="w"> </span>node<span class="w"> </span>add<span class="w"> </span>deliverynet
</pre></div>
</div>
<p>Now you will have to add the delivery networks to this node.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>wwctl<span class="w"> </span>node<span class="w"> </span><span class="nb">set</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--ipaddr<span class="w"> </span><span class="m">10</span>.0.20.250<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--netmask<span class="w"> </span><span class="m">255</span>.255.255.0<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--netname<span class="w"> </span>deliver1<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--nettagadd<span class="w"> </span><span class="nv">network</span><span class="o">=</span><span class="m">10</span>.0.20.0,dynstart<span class="o">=</span><span class="m">10</span>.10.20.10,dynend<span class="o">=</span><span class="m">10</span>.10.20.50<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>deliverynet

wwctl<span class="w"> </span>node<span class="w"> </span><span class="nb">set</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--ipaddr<span class="w"> </span><span class="m">10</span>.0.30.250<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--netmask<span class="w"> </span><span class="m">255</span>.255.255.0<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--netname<span class="w"> </span>deliver2<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--nettagadd<span class="w"> </span><span class="nv">network</span><span class="o">=</span><span class="m">10</span>.0.30.0,dynstart<span class="o">=</span><span class="m">10</span>.10.30.10,dynend<span class="o">=</span><span class="m">10</span>.10.30.50<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>deliverynet
</pre></div>
</div>
<p>The ip address is used as the network address of host in the delivery network and an additional tags is used for definition of the network itself and the dynamic dhcp range.
You can check the result with <code class="docutils literal notranslate"><span class="pre">wwctl</span> <span class="pre">node</span> <span class="pre">list</span></code>.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>wwctl<span class="w"> </span>node<span class="w"> </span>list<span class="w"> </span>-a<span class="w"> </span>deliverynet
<span class="go">NODE         FIELD                             PROFILE  VALUE</span>
<span class="go">deliverynet  Id                                --       deliverynet</span>
<span class="go">deliverynet  Comment                           default  This profile is automatically included for each node</span>
<span class="go">deliverynet  ImageName                         default  leap15.5</span>
<span class="go">deliverynet  Ipxe                              --       (default)</span>
<span class="go">deliverynet  RuntimeOverlay                    --       (hosts,ssh.authorized_keys,syncuser)</span>
<span class="go">deliverynet  SystemOverlay                     --       (wwinit,wwclient,fstab,hostname,ssh.host_keys,issue,resolv,udev.netname,systemd.netname,ifcfg,NetworkManager,debian.interfaces,wicked,ignition)</span>
<span class="go">deliverynet  Root                              --       (initramfs)</span>
<span class="go">deliverynet  Init                              --       (/sbin/init)</span>
<span class="go">deliverynet  Kernel.Args                       --       (quiet crashkernel=no net.ifnames=1)</span>
<span class="go">deliverynet  Profiles                          --       default</span>
<span class="go">deliverynet  PrimaryNetDev                     --       (deliver1)</span>
<span class="go">deliverynet  NetDevs[deliver2].Type            --       (ethernet)</span>
<span class="go">deliverynet  NetDevs[deliver2].OnBoot          --       (true)</span>
<span class="go">deliverynet  NetDevs[deliver2].Ipaddr          --       10.0.30.250</span>
<span class="go">deliverynet  NetDevs[deliver2].Netmask         --       255.255.255.0</span>
<span class="go">deliverynet  NetDevs[deliver2].Tags[dynend]    --       10.10.30.50</span>
<span class="go">deliverynet  NetDevs[deliver2].Tags[dynstart]  --       10.10.30.10</span>
<span class="go">deliverynet  NetDevs[deliver2].Tags[network]   --       10.0.30.0</span>
<span class="go">deliverynet  NetDevs[deliver1].Type            --       (ethernet)</span>
<span class="go">deliverynet  NetDevs[deliver1].OnBoot          --       (true)</span>
<span class="go">deliverynet  NetDevs[deliver1].Ipaddr          --       10.0.20.250</span>
<span class="go">deliverynet  NetDevs[deliver1].Netmask         --       255.255.255.0</span>
<span class="go">deliverynet  NetDevs[deliver1].Primary         --       (true)</span>
<span class="go">deliverynet  NetDevs[deliver1].Tags[network]   --       10.0.20.0</span>
<span class="go">deliverynet  NetDevs[deliver1].Tags[dynend]    --       10.10.20.50</span>
<span class="go">deliverynet  NetDevs[deliver1].Tags[dynstart]  --       10.10.20.10</span>
</pre></div>
</div>
<p>Now the templates of <code class="docutils literal notranslate"><span class="pre">dhcpd</span></code> and/or <code class="docutils literal notranslate"><span class="pre">dnsmasq</span></code> must be modified.
You can edit the configuration files.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>wwctl<span class="w"> </span>overlay<span class="w"> </span>edit<span class="w"> </span>host<span class="w"> </span>etc/dhcpd.conf.ww
wwctl<span class="w"> </span>overlay<span class="w"> </span>edit<span class="w"> </span>host<span class="w"> </span>etc/dnsmasq.d/ww4-hosts.ww
</pre></div>
</div>
<p>For the <code class="docutils literal notranslate"><span class="pre">dhcp</span></code> template you should add following lines</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>{{/* multiple networks */}}
{{- range $node := $.AllNodes}}
{{- if eq $node.Id.Get &quot;deliverynet&quot; }}
{{- range $netname, $netdev := $node.NetDevs}}
# network {{ $netname }}
subnet {{$netdev.Tags.network.Get}} netmask {{$netdev.Netmask.Get}} {
    max-lease-time 120;
    range {{$netdev.Tags.dynstart.Get}} {{$netdev.Tags.dynend.Get}};
    next-server {{$netdev.Ipaddr.Get}};
}
{{- end }}
{{- end }}
{{- end }}
</pre></div>
</div>
<p>and for the <code class="docutils literal notranslate"><span class="pre">dnsmasq</span></code> the following lines should be added</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>{{/* multiple networks */}}
{{- range $node := $.AllNodes}}
{{- if eq $node.Id.Get &quot;deliverynet&quot; }}
{{- range $netname, $netdev := $node.NetDevs}}
# network {{ $netname }}
dhcp-range={{$netdev.Tags.dynstart.Get}},{{$netdev.Tags.dynend.Get}},{{$netdev.Netmask.Get}},6h
{{- end }}
{{- end }}
{{- end }}
</pre></div>
</div>
<p>Note that the <code class="docutils literal notranslate"><span class="pre">{{-</span> <span class="pre">if</span> <span class="pre">eq</span> <span class="pre">$node.Id.Get</span> <span class="pre">&quot;deliverynet&quot;</span> <span class="pre">}}</span></code> is used to identify the dummy host which carries the network information.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="stateless.html" class="btn btn-neutral float-left" title="Stateless Provisioning" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="installation.html" class="btn btn-neutral float-right" title="Warewulf Installation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>